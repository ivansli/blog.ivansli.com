<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>ç¼“å­˜ä¹‹ç‹ - Redis | æå®¢ä¹‹é“</title><meta name="keywords" content="ç¼“å­˜ä¹‹ç‹ - Redis"><meta name="author" content="ivansli"><meta name="copyright" content="ivansli"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="ç¼“å­˜ä¹‹ç‹ - Redis"><meta name="application-name" content="ç¼“å­˜ä¹‹ç‹ - Redis"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="ç¼“å­˜ä¹‹ç‹ - Redis"><meta property="og:url" content="https://blog.ivansli.com/2020/10/09/redis-king-cache/index.html"><meta property="og:site_name" content="æå®¢ä¹‹é“"><meta property="og:description" content="ç¼“å­˜ä¹‹ç‹ - Redis"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://blog.ivansli.com/img/2021/11/2833663222.jpg"><meta property="article:author" content="ivansli"><meta property="article:tag" content="ä¼Šä¸‡çš„å°ç«™,ivansli,ç¼–ç¨‹æŠ€æœ¯,ç¼–ç¨‹æŠ€æœ¯ä¹‹é“,ç¼–ç¨‹åŸç†,goå¼€å‘æŠ€å·§"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://blog.ivansli.com/img/2021/11/2833663222.jpg"><meta name="description" content="ç¼“å­˜ä¹‹ç‹ - Redis"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://blog.ivansli.com/2020/10/09/redis-king-cache/"><link rel="preconnect"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/pluginsSrc/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/pluginsSrc/@fancyapps/ui/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: undefined,
  diytitle: undefined,
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: undefined,
  friends_vue_info: undefined,
  navMusic: false,
  mainTone: undefined,
  authorStatus: {"skills":["ğŸ¤–ï¸ æ•°ç ç§‘æŠ€çˆ±å¥½è€…","ğŸ” åˆ†äº«ä¸çƒ­å¿ƒå¸®åŠ©","ğŸƒ è„šè¸å®åœ°è¡ŒåŠ¨æ´¾"]},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç®€","rightMenuMsgToTraditionalChinese":"è½¬ä¸ºç¹ä½“","rightMenuMsgToSimplifiedChinese":"è½¬ä¸ºç®€ä½“"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: false,
    post: false
  },
  runtime: 'å¤©',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"ä½œè€…: ivansli","link":"é“¾æ¥: ","source":"æ¥æº: æå®¢ä¹‹é“","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚","copySuccess":"å¤åˆ¶æˆåŠŸï¼Œå¤åˆ¶å’Œè½¬è½½è¯·æ ‡æ³¨æœ¬æ–‡åœ°å€"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"ä½ å·²åˆ‡æ¢ä¸ºç¹ä½“","cht_to_chs":"ä½ å·²åˆ‡æ¢ä¸ºç®€ä½“","day_to_night":"ä½ å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"ä½ å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: '/pluginsSrc/flickr-justified-gallery/dist/fjGallery.min.js',
      css: '/pluginsSrc/flickr-justified-gallery/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'æå®¢ä¹‹é“',
  title: 'ç¼“å­˜ä¹‹ç‹ - Redis',
  postAI: '',
  pageFillDescription: '1. Redisæ˜¯ä»€ä¹ˆ, 2. Redisç”±æ¥, 3. Redisä¸ºä»€ä¹ˆå¿«ï¼Ÿ, 4. RESPåè®®, 5. ä¸°å¯Œçš„æ•°æ®ç±»å‹, 6. æ•°æ®è¿‡æœŸæ·˜æ±°ç­–ç•¥, 7. æŒä¹…åŒ–, å°ç»“æ˜¯ä»€ä¹ˆå®˜æ–¹è¿™æ ·è§£é‡Šç®€è¨€ä¹‹å…¨ç§°è¿œç¨‹å­—å…¸æœåŠ¡æ˜¯ä¸€ä¸ªä½¿ç”¨ç¼–å†™çš„å¼€æºæ”¯æŒç½‘ç»œåŸºäºå†…å­˜å¹¶æä¾›å¤šç§è¯­è¨€çš„å¯æŒä¹…åŒ–çš„é”®å€¼å¯¹å­˜å‚¨æ•°æ®åº“ç”±æ¥å¹´æ„å¤§åˆ©çš„ä¸€å®¶åˆ›ä¸šå…¬å¸æ¨å‡ºäº†ä¸€æ¬¾åŸºäºçš„ç½‘ç«™å®æ—¶ç»Ÿè®¡ç³»ç»Ÿç„¶è€Œæ²¡è¿‡å¤šä¹…è¯¥å…¬å¸çš„åˆ›å§‹äººç½‘åä¾¿å¼€å§‹å¯¹çš„æ€§èƒ½æ„Ÿåˆ°å¤±æœ›äºæ˜¯ä»–å†³å®šäº²è‡ªä¸ºé‡èº«å®šåšä¸€ä¸ªæ•°æ®åº“å¹¶äºå¹´å¼€å‘å®Œæˆè¿™ä¸ªæ•°æ®åº“å°±æ˜¯ä¸è¿‡å¹¶ä¸æ»¡è¶³åªå°†ç”¨äºè¿™ä¸€æ¬¾äº§å“è€Œæ˜¯å¸Œæœ›è®©æ›´å¤šçš„äººä½¿ç”¨å®ƒäºæ˜¯åœ¨åŒä¸€å¹´å°†å¼€æºå‘å¸ƒå¹¶å¼€å§‹å’Œçš„å¦ä¸€åä¸»è¦çš„ä»£ç è´¡çŒ®è€…ä¸€èµ·ç»§ç»­ç€çš„å¼€å‘ç›´åˆ°ä»Šå¤©ä»Šå¹´å·²ç»å››åå¤šå²ä¾æ—§åœ¨å­œå­œä¸å€¦åœ°å†™ä»£ç ä¸ºçš„å¼€æºäº‹ä¸šæŒç»­è´¡çŒ®åŠ›é‡ç«¯å£ä¸ºä»€ä¹ˆæ˜¯æ˜¯ä¹å®«æ ¼è¾“å…¥æ³•å¯¹åº”çš„æ•°å­—æ˜¯ä¸€ä½æ„å¤§åˆ©èˆå¥³å¥³æ¼”å‘˜ä½œè€…æ—©å¹´çœ‹ç”µè§†èŠ‚ç›®è§‰å¾—åœ¨èŠ‚ç›®ä¸­çš„ä¸€äº›è¯æ„šè ¢å¯ç¬‘å–œæ¬¢é€ æ¢—ç”¨äºå¹³æ—¶å’Œæœ‹å‹ä»¬äº¤æµäºæ˜¯é€ äº†ä¸€ä¸ªè¯å½¢å®¹æ„šè ¢ä¸å«ä¹‰ç›¸åŒåæ¥é‡æ–°å®šä¹‰äº†å½¢å®¹å…·æœ‰å¾ˆé«˜çš„æŠ€æœ¯ä»·å€¼åŒ…å«æŠ€è‰ºè€å¿ƒå’ŒåŠ³åŠ¨ä½†ä»ç„¶ä¿æŒç®€å•æœ¬è´¨åˆ°äº†ç»™é€‰æ‹©ä¸€ä¸ªæ•°å­—ä½œä¸ºé»˜è®¤ç«¯å£å·æ—¶æ²¡æœ‰å¤šæƒ³æŠŠåœ¨æ‰‹æœºé”®ç›˜ä¸Šå¯¹åº”çš„æ•°å­—æ‹¿æ¥ç”¨äº†ä¸ºä»€ä¹ˆå¿«å®Œå…¨åŸºäºå†…å­˜ç»å¤§éƒ¨åˆ†è¯·æ±‚æ˜¯çº¯ç²¹çš„å†…å­˜æ“ä½œéå¸¸å¿«é€Ÿæ•°æ®ç»“æ„ç®€å•æ•°æ®ç»“æ„æ˜¯ä¸“é—¨è®¾è®¡çš„å¯¹æ•°æ®æ“ä½œä¹Ÿç®€å•é‡‡ç”¨å•çº¿ç¨‹ä¹‹å‰é¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰æ¡ä»¶ä¸å­˜åœ¨å¤šè¿›ç¨‹çº¿ç¨‹åˆ‡æ¢æ¶ˆè€—ä¸å­˜åœ¨åŠ é”é‡Šæ”¾é”æ“ä½œæ²¡æœ‰å› ä¸ºå¯èƒ½å‡ºç°æ­»é”è€Œå¯¼è‡´çš„æ€§èƒ½æ¶ˆè€—éé˜»å¡å¤šè·¯å¤ç”¨æ¨¡å‹åè®®å…¨ç§°å®ç°ç®€å•å¿«é€Ÿè§£æå¯è¯»æ€§å¼ºåè®®å°†ä¼ è¾“çš„ç»“æ„æ•°æ®åˆ†ä¸ºç§æœ€å°å•å…ƒç±»å‹å•å…ƒç»“æŸæ—¶ç»Ÿä¸€åŠ ä¸Šå›è½¦æ¢è¡Œç¬¦å·å•è¡Œå­—ç¬¦ä¸²ä»¥ç¬¦å·å¼€å¤´å¤šè¡Œå­—ç¬¦ä¸²ä»¥ç¬¦å·å¼€å¤´åè·Ÿå­—ç¬¦ä¸²é•¿åº¦æ•´æ•°å€¼ä»¥ç¬¦å·å¼€å¤´åè·Ÿæ•´æ•°çš„å­—ç¬¦ä¸²å½¢å¼é”™è¯¯æ¶ˆæ¯ä»¥ç¬¦å·å¼€å¤´æ•°ç»„ä»¥å·å¼€å¤´åè·Ÿæ•°ç»„çš„é•¿åº¦å•è¡Œå­—ç¬¦ä¸²å¤šè¡Œå­—ç¬¦ä¸²å¤šè¡Œå­—ç¬¦ä¸²å½“ç„¶ä¹Ÿå¯ä»¥è¡¨ç¤ºå•è¡Œå­—ç¬¦ä¸²æ•´æ•°é”™è¯¯å‚æ•°ç±»å‹é”™è¯¯æ•°ç»„ç”¨å¤šè¡Œå­—ç¬¦ä¸²è¡¨ç¤ºä¸è¿‡é•¿åº¦è¦å†™æˆç©ºä¸²ç”¨å¤šè¡Œå­—ç¬¦ä¸²è¡¨ç¤ºé•¿åº¦å¡«æ³¨æ„è¿™é‡Œæœ‰ä¸¤ä¸ªä¸ºä»€ä¹ˆæ˜¯ä¸¤ä¸ªå› ä¸ºä¸¤ä¸ªä¹‹é—´éš”çš„æ˜¯ç©ºä¸²ä¸°å¯Œçš„æ•°æ®ç±»å‹å¸¸ç”¨çš„å‡ ç§æ•°æ®ç±»å‹æ•°æ®è¿‡æœŸæ·˜æ±°ç­–ç•¥æ‡’æ€§åˆ é™¤è§¦å‘æœºåˆ¶å½“è®¿é—®ä¸­é”®å€¼å¯¹æ—¶ä¼šåˆ¤æ–­è¿™ä¸ªé”®å€¼å¯¹æ˜¯å¦è¿‡æœŸå¦‚æœè¿‡æœŸçš„è¯å°±ä¼šåˆ é™¤è¿™ä¸ªé”®å€¼å¯¹å¹¶è¿”å›ä¼˜ç‚¹å¯¹å‹å¥½ä¸ç”¨æ‰§è¡Œä¸å½“å‰å‘½ä»¤æ— å…³çš„æ“ä½œç¼ºç‚¹å¯¹å†…å­˜ä¸å‹å¥½å½“å¤§é‡è¿‡æœŸçš„é”®å€¼å¯¹ä¸è¢«è®¿é—®æ—¶ä¼šæµªè´¹å¤§é‡å†…å­˜ç©ºé—´å®šæœŸåˆ é™¤ä¸ºäº†å¼¥è¡¥æƒ°æ€§åˆ é™¤å¯¹äºå†…å­˜çš„ä¸å‹å¥½ä¸­è¿˜æœ‰ä¸€ç§è¿‡æœŸç­–ç•¥å³å®šæœŸåˆ é™¤è§¦å‘æœºåˆ¶å½“ä¸€ä¸ªé”®å€¼å¯¹è®¾ç½®åä¸­ä¼šç»´æŠ¤ä¸€ä¸ªè¿‡æœŸå­—å…¸è¿™ä¸ªè¿‡æœŸå­—å…¸åœ¨ä¸­ä¼šä½¿ç”¨æ—¶é—´äº‹ä»¶è½®è¯¢è½®è¯¢è¿‡æœŸé”®å€¼å¯¹è¿›è¡Œé‡Šæ”¾é…ç½®æ–‡ä»¶ä¸­é…ç½®é¡¹é…ç½®æ¯ç§’æ‰§è¡Œæ¬¡æ•°é»˜è®¤è¡¨ç¤ºæ¯æ‰§è¡Œä¸€æ¬¡ä¸­é™åˆ¶æ¯æ¬¡è¿‡æœŸæ¸…ç†æ—¶é—´ä¸è¶…è¿‡æ—¶é—´çš„è¿™æ®µæ—¶é—´å†…ä¼šæ‰§è¡Œå¦‚ä¸‹æ­¥éª¤æ“ä½œéšæœºé€‰å–è¿‡æœŸå­—å…¸ä¸­çš„ä¸ªæ·˜æ±°æ‰€æœ‰çš„è¿‡æœŸå¦‚æœè¿‡æœŸè¶…è¿‡ä¸ªåˆ™é‡å¤æ­¥éª¤ä¸»åŠ¨åˆ é™¤ç‰©ç†æœºçš„å†…å­˜ç©ºé—´æ˜¯æœ‰é™çš„å½“æ‰€æœ‰å†…å­˜è¢«å æ»¡ä»¥åæ¥æ”¶åˆ°å†™æ“ä½œå‘½ä»¤åº”è¯¥æ€ä¹ˆå¤„ç†æ­¤æ—¶å°±ä¼šè§¦å‘ä¸»åŠ¨åˆ é™¤è§¦å‘æœºåˆ¶é…ç½®æ–‡ä»¶ä¸­å‚æ•°è®¾ç½®å ç”¨å†…å­˜çš„å¤§å°å½“è¶…è¿‡è¿™ä¸ªå€¼é™å®šä»¥åå°†ä¼šæ ¹æ®è®¾ç½®æ¸…ç†å†…å­˜å¯¹è±¡æœ‰å…³è¿™ä¸ªæé†’ä¸€ç‚¹é›†ç¾¤ç¯å¢ƒä¸‹é€‚å½“è°ƒä½é…ç½®ç»™é¢„ç•™ç©ºé—´å› ä¸ºç©ºé—´å¹¶ä¸åŒ…æ‹¬åœ¨ä¸­æ¸…ç†ç­–ç•¥æ¸…ç†ç­–ç•¥åˆ’åˆ†å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªç»´åº¦ä¸ä¸‰ä¸ªæ–¹é¢ä¸¤ä¸ªç»´åº¦åˆ†åˆ«æ˜¯è¿‡æœŸé”®ä¸­ç­›é€‰æ‰€æœ‰é”®ä¸­ç­›é€‰ä¸‰ä¸ªæ–¹é¢åˆ†åˆ«æ˜¯è¿‡æœŸé”®ä¸­æœ€é•¿æ—¶é—´æœªè°ƒç”¨çš„é”®å€¼å¯¹è¿‡æœŸé”®ä¸­å³å°†è¿‡æœŸçš„é”®å€¼å¯¹è¿‡æœŸé”®ä¸­éšæœºåˆ é™¤æ‰€æœ‰é”®ä¸­æœ€é•¿æ—¶é—´æœªè°ƒç”¨çš„é”®å€¼å¯¹æ‰€æœ‰é”®ä¸­éšæœºåˆ é™¤ä¸æ¸…ç†è¿”å›å¼‚å¸¸æŒä¹…åŒ–ç›®å‰åˆ†ä¸ºç§æŒä¹…åŒ–æ–¹å¼æ··åˆæ¨¡å¼å¼€å¯æ–¹å¼é…ç½®å…³é—­åŠŸèƒ½æ ¸å¿ƒå‡½æ•°è§¦å‘åœºæ™¯æ‰§è¡Œå‘½ä»¤æœªé…ç½®æ‰§è¡Œå‘½ä»¤åŒºåˆ«ä½¿ç”¨ä¸»è¿›ç¨‹è¿›è¡Œå¿«ç…§æ•°æ®çš„æŒä¹…åŒ–ä¼šé˜»å¡å…¶ä»–æ“ä½œå‡ºå­è¿›ç¨‹è¿›è¡Œå¿«ç…§æ•°æ®çš„æŒä¹…åŒ–æ¨èä¼˜ç‚¹æ˜¯ä¸€ä¸ªéå¸¸ç´§å‡‘çš„æ–‡ä»¶ä¿å­˜äº†åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šçš„æ•°æ®é›†éå¸¸é€‚åˆç”¨äºè¿›è¡Œå¤‡ä»½åœ¨æ¢å¤å¤§æ•°æ®é›†æ—¶çš„é€Ÿåº¦æ¯”çš„æ¢å¤é€Ÿåº¦è¦å¿«ç¼ºç‚¹æ•°æ®é›†æ¯”è¾ƒåºå¤§æ—¶å¯èƒ½ä¼šéå¸¸è€—æ—¶é€ æˆæœåŠ¡å™¨åœ¨æŸæ®µæ—¶é—´å†…åœæ­¢å¤„ç†å®¢æˆ·ç«¯æ¯éš”ä¸€æ®µæ—¶é—´æ‰ä¿å­˜ä¸€æ¬¡æ–‡ä»¶åœ¨è¿™ç§æƒ…å†µä¸‹ä¸€æ—¦å‘ç”Ÿæ•…éšœåœæœºä½ å°±å¯èƒ½ä¼šä¸¢å¤±å¥½è¿™æ®µæ—¶é—´çš„æ•°æ®å¼€å¯æ–¹å¼é…ç½®æ ¸å¿ƒå‡½æ•°æ¯å½“æ‰§è¡ŒæœåŠ¡å™¨å®šæ—¶ä»»åŠ¡æˆ–è€…å‡½æ•°æ—¶å‡½æ•°éƒ½ä¼šè¢«è°ƒç”¨è¿™ä¸ªå‡½æ•°æ‰§è¡Œä»¥ä¸‹ä¸¤ä¸ªå·¥ä½œæ ¹æ®æ¡ä»¶å°†ä¸­çš„ç¼“å­˜å†™å…¥åˆ°æ–‡ä»¶æ ¹æ®æ¡ä»¶è°ƒç”¨æˆ–å‡½æ•°å°†æ–‡ä»¶ä¿å­˜åˆ°ç£ç›˜ä¸­ä¼˜ç‚¹å¦‚ä¸å°å¿ƒæ‰§è¡Œå‘½ä»¤åªè¦æ–‡ä»¶æœªè¢«é‡å†™åœæ­¢æœåŠ¡å™¨ç§»é™¤æ–‡ä»¶æœ«å°¾çš„å‘½ä»¤å¹¶é‡å¯å°±å¯ä»¥å°†æ•°æ®é›†æ¢å¤åˆ°æ‰§è¡Œä¹‹å‰çš„çŠ¶æ€å¯è¯»æ€§é«˜é»˜è®¤ä¸ºæ¯ç§’é’Ÿä¸€æ¬¡ä¹Ÿæœ€å¤šåªä¼šä¸¢å¤±ä¸€ç§’é’Ÿçš„æ•°æ®ç¼ºç‚¹æ–‡ä»¶æ¯”è¾ƒå¤§åŠ è½½å…¥å†…å­˜è€—æ—¶æ¯”æ…¢æ··åˆæ¨¡å¼å¼€å¯æ–¹å¼æ˜¾å¼çš„æŸ¥çœ‹æ··åˆæ¨¡å¼çš„æ•°æ®æ‰§è¡Œå‘½ä»¤æŸ¥çœ‹æ–‡ä»¶æ··åˆæ¨¡å¼çš„æ–‡ä»¶æ•°æ®ç›¸å½“äºæŸåˆ»çš„æ ¼å¼å…¨é‡æ•°æ®æ­¤åˆ»ä¹‹åçš„æ ¼å¼å¢é‡æ•°æ®ä¸ºä»€ä¹ˆä½¿ç”¨æ··åˆæ¨¡å¼ä¼˜ç‚¹ä¼˜ç‚¹æ ¼å¼æ•°æ®åŠ è½½å¿«é€Ÿè¿½åŠ çš„æ•°æ®å¯ä»¥å‡å°‘æ•°æ®çš„ä¸¢å¤±æ—¢èƒ½ä¿è¯é‡å¯æ—¶çš„é€Ÿåº¦åˆèƒ½å‡ä½æ•°æ®ä¸¢å¤±çš„é£é™©é‡å¯ä¹‹åæ•°æ®åŠ è½½æºç è¿½è¸ªåˆ¤æ–­æ˜¯å¦å¼€å¯äº†æ˜¯åˆ™é€šè¿‡åŠ è½½æ–‡ä»¶å¦é€šè¿‡åŠ è½½æ–‡ä»¶é€šè¿‡è¯»å–æ–‡ä»¶çš„å‰ä¸ªå­—ç¬¦æ¥åˆ¤æ–­æ˜¯å¦æ˜¯æ··åˆæ¨¡å¼æ˜¯åˆ™å…ˆåŠ è½½æ•°æ®äºŒè¿›åˆ¶æ•°æ®å†ä¸€æ¡ä¸€æ¡çš„åŠ è½½æ•°æ®åè®®æ ¼å¼æ•°æ®å¦ä¸€æ¡ä¸€æ¡çš„åŠ è½½æ•°æ®åè®®æ ¼å¼æ•°æ®å¤§è‡´çš„é‡å¯æ•°æ®åŠ è½½æµç¨‹ä¸ºå°ç»“è‡³äºä¸ºä»€ä¹ˆæ˜¯æœ€æµè¡Œçš„é”®å€¼å¯¹å­˜å‚¨æ•°æ®åº“ä»è€…è§ä»æ™ºè€…è§æ™ºä¸ªäººè®¤ä¸ºæ€»ç»“å‡ ç‚¹æ˜¯å¼€æºçš„èŠ‚çº¦ä¼ä¸šè‡ªç ”æˆæœ¬æ•°æ®ç±»å‹ä¸°å¯Œä¸ä»…ä»…æ˜¯å•çº¯çš„å¤„ç†é€Ÿåº¦å¿«å•æœºè¯»å†™å·¦å³æ”¯æŒæ•°æ®æŒä¹…åŒ–å¤šç§è¯­è¨€æ”¯æŒé™„æ›¾æœ‰ä¸€åŒäº‹åœ¨è¿½æº¯æºç ä¹‹åè¯„ä»·é“è¿™æ˜¯æˆ‘çœ‹è¿‡æœ€èˆ’æœçš„æºç æºç æ³¨é‡Šè¯¦ç»†ä¸è¯´å„ç§å˜é‡å‡½æ•°åç§°ä¹Ÿæ˜¯ååˆ†æ ‡å‡†ç”±æ­¤å¯è§ä¸€æ–‘',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-07-08 15:38:53',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">æå®¢ä¹‹é“</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="anzhiyufont anzhiyu-icon-house-chimney faa-tada"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/booklist/"><i class="anzhiyufont anzhiyu-icon-book faa-tada"></i><span> ä¹¦å•</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada"></i><span> å…³äº</span></a></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="éšæœºå‰å¾€ä¸€ä¸ªæ–‡ç« " href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="åˆ‡æ¢"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">åŸåˆ›</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/" itemprop="url">ä¸­é—´ä»¶</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/redis/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>redis</span></a><a class="article-meta__tags" href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>ä¸­é—´ä»¶</span></a></span></div></div><h1 class="post-title" itemprop="name headline">ç¼“å­˜ä¹‹ç‹ - Redis</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2020-10-08T16:00:00.000Z" title="å‘è¡¨äº 2020-10-09 00:00:00">2020-10-09</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-07-08T07:38:53.313Z" title="æ›´æ–°äº 2024-07-08 15:38:53">2024-07-08</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="æ–‡ç« å­—æ•°"></i><span class="post-meta-label" title="æ–‡ç« å­—æ•°">å­—æ•°æ€»è®¡:</span><span class="word-count" title="æ–‡ç« å­—æ•°">3.2k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="é˜…è¯»æ—¶é•¿"></i><span class="post-meta-label" title="é˜…è¯»æ—¶é•¿">é˜…è¯»æ—¶é•¿:</span><span>13åˆ†é’Ÿ</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="ç¼“å­˜ä¹‹ç‹ - Redis"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="é˜…è¯»é‡">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="ä½œè€…IPå±åœ°ä¸ºä¸Šæµ·"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>ä¸Šæµ·</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="/img/2021/11/2833663222.jpg"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://blog.ivansli.com/2020/10/09/redis-king-cache/"><header><a class="post-meta-categories" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/" itemprop="url">ä¸­é—´ä»¶</a><a href="/tags/redis/" tabindex="-1" itemprop="url">redis</a><a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" tabindex="-1" itemprop="url">ä¸­é—´ä»¶</a><h1 id="CrawlerTitle" itemprop="name headline">ç¼“å­˜ä¹‹ç‹ - Redis</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">ivansli</span><time itemprop="dateCreated datePublished" datetime="2020-10-08T16:00:00.000Z" title="å‘è¡¨äº 2020-10-09 00:00:00">2020-10-09</time><time itemprop="dateCreated datePublished" datetime="2024-07-08T07:38:53.313Z" title="æ›´æ–°äº 2024-07-08 15:38:53">2024-07-08</time></header><h2 id="1-Redisæ˜¯ä»€ä¹ˆ"><a href="#1-Redisæ˜¯ä»€ä¹ˆ" class="headerlink" title="1. Redisæ˜¯ä»€ä¹ˆ"></a>1. Redisæ˜¯ä»€ä¹ˆ</h2><p>Rediså®˜æ–¹è¿™æ ·è§£é‡Š</p>
<blockquote>
<p>Redis is an open source (BSD licensed), in-memory data structure store, used as a database, cache and message broker. It supports data structures such as strings, hashes, lists, sets, sorted sets with range queries, bitmaps, hyperloglogs, geospatial indexes with radius queries and streams. Redis has built-in replication, Lua scripting, LRU eviction, transactions and different levels of on-disk persistence, and provides high availability via Redis Sentinel and automatic partitioning with Redis Cluster.</p>
</blockquote>
<p>ç®€è¨€ä¹‹Redisï¼ˆå…¨ç§°ï¼šRemote Dictionary Server è¿œç¨‹å­—å…¸æœåŠ¡ï¼‰æ˜¯ä¸€ä¸ªä½¿ç”¨ANSI Cç¼–å†™çš„å¼€æºã€æ”¯æŒç½‘ç»œã€åŸºäºå†…å­˜ï¼Œå¹¶æä¾›å¤šç§è¯­è¨€APIçš„å¯æŒä¹…åŒ–çš„é”®å€¼å¯¹å­˜å‚¨æ•°æ®åº“ã€‚</p>
<h2 id="2-Redisç”±æ¥"><a href="#2-Redisç”±æ¥" class="headerlink" title="2. Redisç”±æ¥"></a>2. Redisç”±æ¥</h2><p>2008å¹´ï¼Œæ„å¤§åˆ©çš„ä¸€å®¶åˆ›ä¸šå…¬å¸Merziaæ¨å‡ºäº†ä¸€æ¬¾åŸºäºMySQLçš„ç½‘ç«™å®æ—¶ç»Ÿè®¡ç³»ç»ŸLLOOGGï¼Œç„¶è€Œæ²¡è¿‡å¤šä¹…è¯¥å…¬å¸çš„åˆ›å§‹äººSalvatore Sanfilippoï¼ˆç½‘åAntirezï¼‰ä¾¿å¼€å§‹å¯¹MySQLçš„æ€§èƒ½æ„Ÿåˆ°å¤±æœ›ï¼Œäºæ˜¯ä»–å†³å®šäº²è‡ªä¸ºLLOOGGé‡èº«å®šåšä¸€ä¸ªæ•°æ®åº“ï¼Œå¹¶äº2009å¹´å¼€å‘å®Œæˆï¼Œè¿™ä¸ªæ•°æ®åº“å°±æ˜¯Redisã€‚</p>
<p>ä¸è¿‡Salvatore Sanfilippoå¹¶ä¸æ»¡è¶³åªå°†Redisç”¨äºLLOOGGè¿™ä¸€æ¬¾äº§å“ï¼Œè€Œæ˜¯å¸Œæœ›è®©æ›´å¤šçš„äººä½¿ç”¨å®ƒï¼Œäºæ˜¯åœ¨åŒä¸€å¹´Salvatore Sanfilippoå°†Rediså¼€æºå‘å¸ƒï¼Œå¹¶å¼€å§‹å’ŒRedisçš„å¦ä¸€åä¸»è¦çš„ä»£ç è´¡çŒ®è€…Pieter Noordhuisä¸€èµ·ç»§ç»­ç€Redisçš„å¼€å‘ï¼Œç›´åˆ°ä»Šå¤©ã€‚</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/2021/11/2833663222.jpg">

<p>Antirezä»Šå¹´å·²ç»å››åå¤šå²ï¼Œä¾æ—§åœ¨å­œå­œä¸å€¦åœ°å†™ä»£ç ï¼Œä¸ºRedisçš„å¼€æºäº‹ä¸šæŒç»­è´¡çŒ®åŠ›é‡ã€‚</p>
<p><code>Redisç«¯å£ä¸ºä»€ä¹ˆæ˜¯6379ï¼Ÿ</code><br>6379 æ˜¯ â€œMERZ â€œ ä¹å®«æ ¼è¾“å…¥æ³•å¯¹åº”çš„æ•°å­—ã€‚<br>Alessia Merz æ˜¯ä¸€ä½æ„å¤§åˆ©èˆå¥³ã€å¥³æ¼”å‘˜ã€‚Redis ä½œè€… Antirez æ—©å¹´çœ‹ç”µè§†èŠ‚ç›®ï¼Œè§‰å¾— Merz åœ¨èŠ‚ç›®ä¸­çš„ä¸€äº›è¯æ„šè ¢å¯ç¬‘ï¼ŒAntirez å–œæ¬¢é€ â€œæ¢—â€ç”¨äºå¹³æ—¶å’Œæœ‹å‹ä»¬äº¤æµï¼Œäºæ˜¯é€ äº†ä¸€ä¸ªè¯ â€œMERZâ€ï¼Œå½¢å®¹æ„šè ¢ï¼Œä¸ â€œstupidâ€ å«ä¹‰ç›¸åŒã€‚<br>åæ¥ Antirez é‡æ–°å®šä¹‰äº† â€œMERZâ€ ï¼Œå½¢å®¹â€å…·æœ‰å¾ˆé«˜çš„æŠ€æœ¯ä»·å€¼ï¼ŒåŒ…å«æŠ€è‰ºã€è€å¿ƒå’ŒåŠ³åŠ¨ï¼Œä½†ä»ç„¶ä¿æŒç®€å•æœ¬è´¨â€œã€‚<br>åˆ°äº†ç»™ Redis é€‰æ‹©ä¸€ä¸ªæ•°å­—ä½œä¸ºé»˜è®¤ç«¯å£å·æ—¶ï¼ŒAntirez æ²¡æœ‰å¤šæƒ³ï¼ŒæŠŠ â€œMERZâ€ åœ¨æ‰‹æœºé”®ç›˜ä¸Šå¯¹åº”çš„æ•°å­— 6379 æ‹¿æ¥ç”¨äº†ã€‚</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/2021/11/1157818880.jpg">


<h2 id="3-Redisä¸ºä»€ä¹ˆå¿«ï¼Ÿ"><a href="#3-Redisä¸ºä»€ä¹ˆå¿«ï¼Ÿ" class="headerlink" title="3. Redisä¸ºä»€ä¹ˆå¿«ï¼Ÿ"></a>3. Redisä¸ºä»€ä¹ˆå¿«ï¼Ÿ</h2><ol>
<li><p>å®Œå…¨åŸºäºå†…å­˜ï¼Œç»å¤§éƒ¨åˆ†è¯·æ±‚æ˜¯çº¯ç²¹çš„å†…å­˜æ“ä½œï¼Œéå¸¸å¿«é€Ÿ</p>
</li>
<li><p>æ•°æ®ç»“æ„ç®€å•(æ•°æ®ç»“æ„æ˜¯ä¸“é—¨è®¾è®¡çš„)ï¼Œå¯¹æ•°æ®æ“ä½œä¹Ÿç®€å•</p>
</li>
<li><p>é‡‡ç”¨å•çº¿ç¨‹(6.xä¹‹å‰)ï¼Œé¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰æ¡ä»¶</p>
<ul>
<li><p>ä¸å­˜åœ¨å¤šè¿›ç¨‹&#x2F;çº¿ç¨‹åˆ‡æ¢æ¶ˆè€— CPU</p>
</li>
<li><p>ä¸å­˜åœ¨åŠ é”&#x2F;é‡Šæ”¾é”æ“ä½œï¼Œæ²¡æœ‰å› ä¸ºå¯èƒ½å‡ºç°æ­»é”è€Œå¯¼è‡´çš„æ€§èƒ½æ¶ˆè€—</p>
</li>
</ul>
</li>
<li><p>éé˜»å¡I&#x2F;Oå¤šè·¯å¤ç”¨æ¨¡å‹</p>
</li>
</ol>
<h2 id="4-RESPåè®®"><a href="#4-RESPåè®®" class="headerlink" title="4. RESPåè®®"></a>4. RESPåè®®</h2><p>RESPå…¨ç§°ï¼šREdis Serialization Protocol</p>
<ul>
<li>å®ç°ç®€å•</li>
<li>å¿«é€Ÿè§£æ</li>
<li>å¯è¯»æ€§å¼º</li>
</ul>
<p>Redisåè®®å°†ä¼ è¾“çš„ç»“æ„æ•°æ®åˆ†ä¸º5ç§æœ€å°å•å…ƒç±»å‹ï¼Œå•å…ƒç»“æŸæ—¶ç»Ÿä¸€åŠ ä¸Šå›è½¦æ¢è¡Œç¬¦å·<code>\r\n</code>ã€‚</p>
<ol>
<li>å•è¡Œå­—ç¬¦ä¸² ä»¥ + ç¬¦å·å¼€å¤´ã€‚</li>
<li>å¤šè¡Œå­—ç¬¦ä¸² ä»¥ $ ç¬¦å·å¼€å¤´ï¼Œåè·Ÿå­—ç¬¦ä¸²é•¿åº¦ã€‚</li>
<li>æ•´æ•°å€¼ ä»¥ : ç¬¦å·å¼€å¤´ï¼Œåè·Ÿæ•´æ•°çš„å­—ç¬¦ä¸²å½¢å¼ã€‚</li>
<li>é”™è¯¯æ¶ˆæ¯ ä»¥ - ç¬¦å·å¼€å¤´ã€‚</li>
<li>æ•°ç»„ ä»¥ * å·å¼€å¤´ï¼Œåè·Ÿæ•°ç»„çš„é•¿åº¦ã€‚</li>
</ol>
<ul>
<li>å•è¡Œå­—ç¬¦ä¸² hello world<br>+hello world\r\n</li>
<li>å¤šè¡Œå­—ç¬¦ä¸² hello world<br>$11\r\nhello world\r\n<br>å¤šè¡Œå­—ç¬¦ä¸²å½“ç„¶ä¹Ÿå¯ä»¥è¡¨ç¤ºå•è¡Œå­—ç¬¦ä¸²ã€‚</li>
<li>æ•´æ•° 1024<br>:1024\r\n</li>
<li>é”™è¯¯ å‚æ•°ç±»å‹é”™è¯¯<br>-WRONGTYPE Operation against a key holding the wrong kind of value\r\n</li>
<li>æ•°ç»„ [1,2,3]<br>*3\r\n:1\r\n:2\r\n:3\r\n</li>
<li>NULL ç”¨å¤šè¡Œå­—ç¬¦ä¸²è¡¨ç¤ºï¼Œä¸è¿‡é•¿åº¦è¦å†™æˆ-1ã€‚<br>$-1\r\n</li>
<li>ç©ºä¸² ç”¨å¤šè¡Œå­—ç¬¦ä¸²è¡¨ç¤ºï¼Œé•¿åº¦å¡« 0ã€‚<br>$0\r\n\r\n</li>
</ul>
<p>æ³¨æ„è¿™é‡Œæœ‰ä¸¤ä¸ª\r\nã€‚ä¸ºä»€ä¹ˆæ˜¯ä¸¤ä¸ª?å› ä¸ºä¸¤ä¸ª\r\nä¹‹é—´,éš”çš„æ˜¯ç©ºä¸².</p>
<h2 id="5-ä¸°å¯Œçš„æ•°æ®ç±»å‹"><a href="#5-ä¸°å¯Œçš„æ•°æ®ç±»å‹" class="headerlink" title="5. ä¸°å¯Œçš„æ•°æ®ç±»å‹"></a>5. ä¸°å¯Œçš„æ•°æ®ç±»å‹</h2><p>å¸¸ç”¨çš„å‡ ç§æ•°æ®ç±»å‹</p>
<ul>
<li>string</li>
<li>list</li>
<li>set</li>
<li>zset</li>
<li>hash</li>
<li>HyperLogLog</li>
<li>bitmap</li>
<li>Geo</li>
</ul>
<h2 id="6-æ•°æ®è¿‡æœŸæ·˜æ±°ç­–ç•¥"><a href="#6-æ•°æ®è¿‡æœŸæ·˜æ±°ç­–ç•¥" class="headerlink" title="6. æ•°æ®è¿‡æœŸæ·˜æ±°ç­–ç•¥"></a>6. æ•°æ®è¿‡æœŸæ·˜æ±°ç­–ç•¥</h2><ol>
<li>æ‡’æ€§åˆ é™¤</li>
</ol>
<p>è§¦å‘æœºåˆ¶<br>å½“è®¿é—®redisä¸­é”®å€¼å¯¹æ—¶ä¼šåˆ¤æ–­è¿™ä¸ªé”®å€¼å¯¹æ˜¯å¦è¿‡æœŸ,å¦‚æœè¿‡æœŸçš„è¯å°±ä¼šåˆ é™¤è¿™ä¸ªé”®å€¼å¯¹å¹¶è¿”å›nil</p>
<p>ä¼˜ç‚¹ï¼šå¯¹CPUå‹å¥½,ä¸ç”¨æ‰§è¡Œä¸å½“å‰å‘½ä»¤æ— å…³çš„æ“ä½œ<br>ç¼ºç‚¹ï¼šå¯¹å†…å­˜ä¸å‹å¥½,å½“å¤§é‡è¿‡æœŸçš„é”®å€¼å¯¹ä¸è¢«è®¿é—®æ—¶ä¼šæµªè´¹å¤§é‡å†…å­˜ç©ºé—´</p>
<ol start="2">
<li>å®šæœŸåˆ é™¤</li>
</ol>
<p>ä¸ºäº†å¼¥è¡¥æƒ°æ€§åˆ é™¤å¯¹äºå†…å­˜çš„ä¸å‹å¥½,redisä¸­è¿˜æœ‰ä¸€ç§è¿‡æœŸç­–ç•¥å³å®šæœŸåˆ é™¤ã€‚</p>
<ul>
<li>è§¦å‘æœºåˆ¶<br>å½“ä¸€ä¸ªé”®å€¼å¯¹è®¾ç½®expireåï¼Œredisä¸­ä¼šç»´æŠ¤ä¸€ä¸ªè¿‡æœŸå­—å…¸ã€‚è¿™ä¸ªè¿‡æœŸå­—å…¸åœ¨redisä¸­ä¼šä½¿ç”¨serverCronæ—¶é—´äº‹ä»¶è½®è¯¢ï¼Œè½®è¯¢è¿‡æœŸé”®å€¼å¯¹è¿›è¡Œé‡Šæ”¾ã€‚ï¼ˆredis.confé…ç½®æ–‡ä»¶ä¸­hzé…ç½®é¡¹é…ç½®ï¼ŒserverCronæ¯ç§’æ‰§è¡Œæ¬¡æ•°, é»˜è®¤10è¡¨ç¤ºæ¯100msæ‰§è¡Œä¸€æ¬¡serverCronï¼‰</li>
</ul>
<p>redisä¸­é™åˆ¶æ¯æ¬¡è¿‡æœŸkeyæ¸…ç†æ—¶é—´ä¸è¶…è¿‡CPUæ—¶é—´çš„25%ï¼Œè¿™æ®µæ—¶é—´å†…ä¼šæ‰§è¡Œå¦‚ä¸‹æ­¥éª¤æ“ä½œï¼š</p>
<p>I. éšæœºé€‰å–è¿‡æœŸå­—å…¸ä¸­çš„100ä¸ªkey</p>
<p>II. æ·˜æ±°æ‰€æœ‰çš„è¿‡æœŸkey</p>
<p>III. å¦‚æœè¿‡æœŸkeyè¶…è¿‡25ä¸ªåˆ™é‡å¤æ­¥éª¤1</p>
<ol start="3">
<li>ä¸»åŠ¨åˆ é™¤</li>
</ol>
<p>ç‰©ç†æœºçš„å†…å­˜ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œå½“æ‰€æœ‰å†…å­˜è¢«å æ»¡ä»¥åredisæ¥æ”¶åˆ°å†™æ“ä½œå‘½ä»¤åº”è¯¥æ€ä¹ˆå¤„ç†ï¼Ÿæ­¤æ—¶å°±ä¼šè§¦å‘ä¸»åŠ¨åˆ é™¤</p>
<p>è§¦å‘æœºåˆ¶<br>redis.confé…ç½®æ–‡ä»¶ä¸­maxmemoryå‚æ•°è®¾ç½®rediså ç”¨å†…å­˜çš„å¤§å°ï¼Œå½“è¶…è¿‡è¿™ä¸ªå€¼é™å®šä»¥åå°†ä¼šæ ¹æ®maxmemory-policyè®¾ç½®æ¸…ç†rediså†…å­˜å¯¹è±¡<br>æœ‰å…³è¿™ä¸ªmaxmemoryæé†’ä¸€ç‚¹ï¼šé›†ç¾¤ç¯å¢ƒä¸‹é€‚å½“è°ƒä½maxmemoryé…ç½®,ç»™output bufferé¢„ç•™ç©ºé—´ã€‚å› ä¸ºoutput bufferç©ºé—´å¹¶ä¸åŒ…æ‹¬åœ¨maxmemoryä¸­</p>
<p>æ¸…ç†ç­–ç•¥<br>æ¸…ç†ç­–ç•¥åˆ’åˆ†å¯ä»¥åˆ†ä¸º<code>ä¸¤ä¸ªç»´åº¦</code>ä¸<code>ä¸‰ä¸ªæ–¹é¢</code><br><code>ä¸¤ä¸ªç»´åº¦</code>åˆ†åˆ«æ˜¯è¿‡æœŸé”®ä¸­ç­›é€‰ã€æ‰€æœ‰é”®ä¸­ç­›é€‰<br><code>ä¸‰ä¸ªæ–¹é¢</code>åˆ†åˆ«æ˜¯ lruã€ttlã€random</p>
<ol>
<li>volatile-lruï¼šè¿‡æœŸé”®ä¸­æœ€é•¿æ—¶é—´æœªè°ƒç”¨çš„é”®å€¼å¯¹</li>
<li>volatile-ttlï¼šè¿‡æœŸé”®ä¸­å³å°†è¿‡æœŸçš„é”®å€¼å¯¹</li>
<li>volatile-randomï¼šè¿‡æœŸé”®ä¸­éšæœºåˆ é™¤</li>
<li>allkeys-lruï¼šæ‰€æœ‰é”®ä¸­æœ€é•¿æ—¶é—´æœªè°ƒç”¨çš„é”®å€¼å¯¹</li>
<li>allkeys-randomï¼šæ‰€æœ‰é”®ä¸­éšæœºåˆ é™¤</li>
<li>noevicationï¼šä¸æ¸…ç†,è¿”å›å¼‚å¸¸</li>
</ol>
<h2 id="7-æŒä¹…åŒ–"><a href="#7-æŒä¹…åŒ–" class="headerlink" title="7. æŒä¹…åŒ–"></a>7. æŒä¹…åŒ–</h2><p>ç›®å‰ï¼Œåˆ†ä¸º3ç§æŒä¹…åŒ–æ–¹å¼</p>
<ol>
<li>RDB</li>
<li>AOF</li>
<li>æ··åˆæ¨¡å¼ï¼ˆRDB+AOFï¼‰</li>
</ol>
<p>RDBï¼ˆRedis DataBaseï¼‰</p>
<ul>
<li>å¼€å¯æ–¹å¼<br>redis.confé…ç½®save</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#   save &quot;&quot;    # å…³é—­RDB</span><br><span class="line"></span><br><span class="line">save 900 1         # after 900 sec (15 min) if at least 1 key changed</span><br><span class="line">save 300 10       # after 300 sec (5 min) if at least 10 keys changed</span><br><span class="line">save 60 10000  # after 60 sec if at least 10000 keys changed</span><br></pre></td></tr></table></figure>

<p>åŠŸèƒ½æ ¸å¿ƒå‡½æ•°ï¼šrdbSave() &#x2F; rdbLoad()<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/2021/11/3947218656.jpg"></p>
<ul>
<li>RDBè§¦å‘åœºæ™¯ï¼š</li>
</ul>
<ol>
<li>æ‰§è¡Œ SHUTDOWN å‘½ä»¤(æœªé…ç½®AOF)</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; shutdown</span><br><span class="line">21051:M 08 Jun 2020 17:50:31.772 # User requested shutdown...</span><br><span class="line">21051:M 08 Jun 2020 17:50:31.772 * Saving the final RDB snapshot before exiting.</span><br><span class="line">21051:M 08 Jun 2020 17:50:31.776 * DB saved on disk</span><br><span class="line">21051:M 08 Jun 2020 17:50:31.776 * Removing the pid file.</span><br><span class="line">21051:M 08 Jun 2020 17:50:31.776 # Redis is now ready to exit, bye bye...</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>æ‰§è¡Œ SAVE&#x2F;BGSAVE å‘½ä»¤</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; BGSAVE</span><br><span class="line">21499:M 08 Jun 2020 17:53:18.596 * Background saving started by pid 21528</span><br><span class="line">Background saving started</span><br><span class="line">127.0.0.1:6379&gt; 21528:C 08 Jun 2020 17:53:18.601 * DB saved on disk</span><br><span class="line">21528:C 08 Jun 2020 17:53:18.601 * RDB: 0 MB of memory used by copy-on-write</span><br><span class="line">21499:M 08 Jun 2020 17:53:18.681 * Background saving terminated with success</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>SAVE/BGSAVEåŒºåˆ«</code><br>SAVE ï¼šä½¿ç”¨ä¸»è¿›ç¨‹è¿›è¡ŒRDBå¿«ç…§æ•°æ®çš„æŒä¹…åŒ–ï¼ˆä¼šé˜»å¡Rediså…¶ä»–æ“ä½œï¼‰<br>BGSAVE ï¼šfork()å‡ºå­è¿›ç¨‹è¿›è¡ŒRDBå¿«ç…§æ•°æ®çš„æŒä¹…åŒ–ï¼ˆæ¨èï¼‰</p>
</blockquote>
<p>ä¼˜ç‚¹ï¼š<br>1.RDBæ˜¯ä¸€ä¸ªéå¸¸ç´§å‡‘çš„æ–‡ä»¶ï¼Œä¿å­˜äº†Redisåœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šçš„æ•°æ®é›†ï¼Œéå¸¸é€‚åˆç”¨äºè¿›è¡Œå¤‡ä»½<br>2.RDBåœ¨æ¢å¤å¤§æ•°æ®é›†æ—¶çš„é€Ÿåº¦æ¯” AOF çš„æ¢å¤é€Ÿåº¦è¦å¿«<br>ç¼ºç‚¹ï¼š<br>1.æ•°æ®é›†æ¯”è¾ƒåºå¤§æ—¶ï¼Œfork()å¯èƒ½ä¼šéå¸¸è€—æ—¶ï¼Œé€ æˆæœåŠ¡å™¨åœ¨æŸæ®µæ—¶é—´å†…åœæ­¢å¤„ç†å®¢æˆ·ç«¯<br>2.æ¯éš”ä¸€æ®µæ—¶é—´æ‰ä¿å­˜ä¸€æ¬¡RDBæ–‡ä»¶ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€æ—¦å‘ç”Ÿæ•…éšœåœæœºï¼Œä½ å°±å¯èƒ½ä¼šä¸¢å¤±å¥½è¿™æ®µæ—¶é—´çš„æ•°æ®</p>
<p>AOFï¼ˆAppend-only fileï¼‰</p>
<ul>
<li>å¼€å¯æ–¹å¼<br>redis.confé…ç½®</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">appendonly yes</span><br><span class="line"></span><br><span class="line"># appendfsync always</span><br><span class="line"># appendfsync no</span><br><span class="line">appendfsync everysec</span><br></pre></td></tr></table></figure>

<p>æ ¸å¿ƒå‡½æ•°ï¼šflushAppendOnlyFile()<br>æ¯å½“æ‰§è¡ŒæœåŠ¡å™¨(å®šæ—¶)ä»»åŠ¡æˆ–è€…å‡½æ•°æ—¶flushAppendOnlyFileå‡½æ•°éƒ½ä¼šè¢«è°ƒç”¨ï¼Œè¿™ä¸ªå‡½æ•°æ‰§è¡Œä»¥ä¸‹ä¸¤ä¸ªå·¥ä½œ<br>WRITEï¼šæ ¹æ®æ¡ä»¶ï¼Œå°† aof_buf ä¸­çš„ç¼“å­˜å†™å…¥åˆ° AOF æ–‡ä»¶<br>SAVEï¼šæ ¹æ®æ¡ä»¶ï¼Œè°ƒç”¨ fsync æˆ– fdatasync å‡½æ•°ï¼Œå°† AOF æ–‡ä»¶ä¿å­˜åˆ°ç£ç›˜ä¸­</p>
<p>ä¼˜ç‚¹ï¼š<br>1.å¦‚ä¸å°å¿ƒæ‰§è¡Œflushallå‘½ä»¤ï¼Œ åªè¦AOFæ–‡ä»¶æœªè¢«é‡å†™ï¼Œåœæ­¢æœåŠ¡å™¨ï¼Œ ç§»é™¤AOFæ–‡ä»¶æœ«å°¾çš„FLUSHALLå‘½ä»¤å¹¶é‡å¯Redisï¼Œå°±å¯ä»¥å°†æ•°æ®é›†æ¢å¤åˆ°flushallæ‰§è¡Œä¹‹å‰çš„çŠ¶æ€<br>2.å¯è¯»æ€§é«˜<br>3.é»˜è®¤ä¸ºæ¯ç§’é’Ÿfsyncä¸€æ¬¡ï¼Œä¹Ÿæœ€å¤šåªä¼šä¸¢å¤±ä¸€ç§’é’Ÿçš„æ•°æ®</p>
<p>ç¼ºç‚¹ï¼š<br>1.AOFæ–‡ä»¶æ¯”è¾ƒå¤§<br>2.åŠ è½½å…¥å†…å­˜ï¼Œè€—æ—¶æ¯”RDBæ…¢</p>
<p>æ··åˆæ¨¡å¼</p>
<ul>
<li>å¼€å¯æ–¹å¼</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># When rewriting the AOF file, Redis is able to use an RDB preamble in the</span><br><span class="line"># AOF file for faster rewrites and recoveries. When this option is turned</span><br><span class="line"># on the rewritten AOF file is composed of two different stanzas:</span><br><span class="line">#</span><br><span class="line">#   [RDB file][AOF tail]</span><br><span class="line">#</span><br><span class="line"># When loading Redis recognizes that the AOF file starts with the &quot;REDIS&quot;</span><br><span class="line"># string and loads the prefixed RDB file, and continues loading the AOF</span><br><span class="line"># tail.</span><br><span class="line">aof-use-rdb-preamble yes</span><br></pre></td></tr></table></figure>

<ul>
<li>æ˜¾å¼çš„æŸ¥çœ‹æ··åˆæ¨¡å¼çš„æ•°æ®</li>
</ul>
<ol>
<li>æ‰§è¡ŒBGREWRITEAOFå‘½ä»¤</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">âœ software redis-cli</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">(empty list or set)</span><br><span class="line">127.0.0.1:6379&gt; set name ivansli</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set today 20200608</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) &quot;today&quot;</span><br><span class="line">2) &quot;name&quot;</span><br><span class="line">127.0.0.1:6379&gt; BGREWRITEAOF</span><br><span class="line">Background append only file rewriting started</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; set time 19:15:55</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>æŸ¥çœ‹appendonly.aofæ–‡ä»¶</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">REDIS0009ï¿½      redis-ver5.0.7ï¿½</span><br><span class="line">redis-bitsï¿½@ï¿½ctimeÂ»</span><br><span class="line">ï¿½^used-memï¿½ï¿½</span><br><span class="line">aof-preambleï¿½ï¿½ï¿½today &lt;4nameivansliï¿½ï¿½4ï¿½wqï¿½ï¿½ï¿½*2</span><br><span class="line">$6</span><br><span class="line">SELECT</span><br><span class="line">$1</span><br><span class="line">0</span><br><span class="line">*3</span><br><span class="line">$3</span><br><span class="line">set</span><br><span class="line">$4</span><br><span class="line">time</span><br><span class="line">$8</span><br><span class="line">19:15:55</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ··åˆæ¨¡å¼çš„AOFæ–‡ä»¶æ•°æ®ï¼Œç›¸å½“äºï¼š<br>æŸåˆ»çš„RDBæ ¼å¼å…¨é‡æ•°æ® + æ­¤åˆ»ä¹‹åçš„RESPæ ¼å¼å¢é‡æ•°æ®</p>
</blockquote>
<p>ä¸ºä»€ä¹ˆä½¿ç”¨æ··åˆæ¨¡å¼ï¼ˆRDBä¼˜ç‚¹+AOFä¼˜ç‚¹ï¼‰ï¼š</p>
<ol>
<li>RDBæ ¼å¼æ•°æ®åŠ è½½å¿«é€Ÿ</li>
<li>AOFè¿½åŠ çš„RESPæ•°æ®ï¼Œå¯ä»¥å‡å°‘æ•°æ®çš„ä¸¢å¤±</li>
<li>æ—¢èƒ½ä¿è¯Redisé‡å¯æ—¶çš„é€Ÿåº¦ï¼Œåˆèƒ½å‡ä½æ•°æ®ä¸¢å¤±çš„é£é™©</li>
</ol>
<p>é‡å¯ä¹‹åæ•°æ®åŠ è½½</p>
<p>æºç (V5.08)è¿½è¸ª<br>server.c<br><code>main() -&gt; loadDataFromDisk()</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">/* Function called at startup to load RDB or AOF file in memory. */</span><br><span class="line">void loadDataFromDisk(void) &#123;</span><br><span class="line">    long long start = ustime();</span><br><span class="line">    if (server.aof_state == AOF_ON) &#123;</span><br><span class="line">        if (loadAppendOnlyFile(server.aof_filename) == C_OK)</span><br><span class="line">            serverLog(LL_NOTICE,&quot;DB loaded from append only file: %.3f seconds&quot;,(float)(ustime()-start)/1000000);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        rdbSaveInfo rsi = RDB_SAVE_INFO_INIT;</span><br><span class="line">        if (rdbLoad(server.rdb_filename,&amp;rsi) == C_OK) &#123;</span><br><span class="line">            serverLog(LL_NOTICE,&quot;DB loaded from disk: %.3f seconds&quot;,</span><br><span class="line">                (float)(ustime()-start)/1000000);</span><br><span class="line"></span><br><span class="line">            /* Restore the replication ID / offset from the RDB file. */</span><br><span class="line">            if ((server.masterhost ||</span><br><span class="line">                (server.cluster_enabled &amp;&amp;</span><br><span class="line">                nodeIsSlave(server.cluster-&gt;myself))) &amp;&amp;</span><br><span class="line">                rsi.repl_id_is_set &amp;&amp;</span><br><span class="line">                rsi.repl_offset != -1 &amp;&amp;</span><br><span class="line">                /* Note that older implementations may save a repl_stream_db</span><br><span class="line">                 * of -1 inside the RDB file in a wrong way, see more</span><br><span class="line">                 * information in function rdbPopulateSaveInfo. */</span><br><span class="line">                rsi.repl_stream_db != -1)</span><br><span class="line">            &#123;</span><br><span class="line">                memcpy(server.replid,rsi.repl_id,sizeof(server.replid));</span><br><span class="line">                server.master_repl_offset = rsi.repl_offset;</span><br><span class="line">                /* If we are a slave, create a cached master from this</span><br><span class="line">                 * information, in order to allow partial resynchronizations</span><br><span class="line">                 * with masters. */</span><br><span class="line">                replicationCacheMasterUsingMyself();</span><br><span class="line">                selectDb(server.cached_master,rsi.repl_stream_db);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else if (errno != ENOENT) &#123;</span><br><span class="line">            serverLog(LL_WARNING,&quot;Fatal error loading the DB: %s. Exiting.&quot;,strerror(errno));</span><br><span class="line">            exit(1);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ¤æ–­æ˜¯å¦å¼€å¯äº†AOF</p>
<ul>
<li>æ˜¯ï¼šåˆ™é€šè¿‡loadAppendOnlyFile() åŠ è½½AOFæ–‡ä»¶</li>
<li>å¦ï¼šé€šè¿‡rdbLoad() åŠ è½½RDBæ–‡ä»¶</li>
</ul>
<p>loadAppendOnlyFile()</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">/* Replay the append log file. On success C_OK is returned. On non fatal</span><br><span class="line"> * error (the append only file is zero-length) C_ERR is returned. On</span><br><span class="line"> * fatal error an error message is logged and the program exists. */</span><br><span class="line">int loadAppendOnlyFile(char *filename) &#123;</span><br><span class="line">    struct client *fakeClient;</span><br><span class="line">    FILE *fp = fopen(filename,&quot;r&quot;);</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    /* Check if this AOF file has an RDB preamble. In that case we need to</span><br><span class="line">     * load the RDB file and later continue loading the AOF tail. */</span><br><span class="line">    char sig[5]; /* &quot;REDIS&quot; */</span><br><span class="line">    if (fread(sig,1,5,fp) != 5 || memcmp(sig,&quot;REDIS&quot;,5) != 0) &#123;</span><br><span class="line">        /* No RDB preamble, seek back at 0 offset. */</span><br><span class="line">        if (fseek(fp,0,SEEK_SET) == -1) goto readerr;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        /* RDB preamble. Pass loading the RDB functions. */</span><br><span class="line">        rio rdb;</span><br><span class="line"></span><br><span class="line">        serverLog(LL_NOTICE,&quot;Reading RDB preamble from AOF file...&quot;);</span><br><span class="line">        if (fseek(fp,0,SEEK_SET) == -1) goto readerr;</span><br><span class="line">        rioInitWithFile(&amp;rdb,fp);</span><br><span class="line">        if (rdbLoadRio(&amp;rdb,NULL,1) != C_OK) &#123;</span><br><span class="line">            serverLog(LL_WARNING,&quot;Error reading the RDB preamble of the AOF file, AOF loading aborted&quot;);</span><br><span class="line">            goto readerr;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            serverLog(LL_NOTICE,&quot;Reading the remaining AOF tail...&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* Read the actual AOF file, in REPL format, command by command. */</span><br><span class="line">    while(1) &#123;</span><br><span class="line">        int argc, j;</span><br><span class="line">        unsigned long len;</span><br><span class="line">        robj **argv;</span><br><span class="line">        char buf[128];</span><br><span class="line">        sds argsds;</span><br><span class="line">        struct redisCommand *cmd;</span><br><span class="line"></span><br><span class="line">        /* Serve the clients from time to time */</span><br><span class="line">        if (!(loops++ % 1000)) &#123;</span><br><span class="line">            loadingProgress(ftello(fp));</span><br><span class="line">            processEventsWhileBlocked();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (fgets(buf,sizeof(buf),fp) == NULL) &#123;</span><br><span class="line">            if (feof(fp))</span><br><span class="line">                break;</span><br><span class="line">            else</span><br><span class="line">                goto readerr;</span><br><span class="line">        &#125;</span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡è¯»å–AOFæ–‡ä»¶çš„å‰5ä¸ªå­—ç¬¦æ¥åˆ¤æ–­æ˜¯å¦æ˜¯RDB+AOFæ··åˆæ¨¡å¼</p>
<ul>
<li>æ˜¯ï¼šåˆ™å…ˆåŠ è½½RDBæ•°æ®(äºŒè¿›åˆ¶æ•°æ®)ï¼Œå†ä¸€æ¡ä¸€æ¡çš„åŠ è½½AOFæ•°æ®(RESPåè®®æ ¼å¼æ•°æ®)</li>
<li>å¦ï¼šä¸€æ¡ä¸€æ¡çš„åŠ è½½AOFæ•°æ®(RESPåè®®æ ¼å¼æ•°æ®)</li>
</ul>
<p>å¤§è‡´çš„é‡å¯æ•°æ®åŠ è½½æµç¨‹ä¸ºï¼š<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/2021/11/2842838252.jpg"></p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>è‡³äºRedisä¸ºä»€ä¹ˆæ˜¯æœ€æµè¡Œçš„é”®å€¼å¯¹å­˜å‚¨æ•°æ®åº“ï¼Œä»è€…è§ä»æ™ºè€…è§æ™ºã€‚</p>
<p>ä¸ªäººè®¤ä¸ºï¼Œæ€»ç»“å‡ ç‚¹ï¼š</p>
<ol>
<li>æ˜¯å¼€æºçš„ï¼ˆèŠ‚çº¦ä¼ä¸šè‡ªç ”æˆæœ¬ï¼‰</li>
<li>æ•°æ®ç±»å‹ä¸°å¯Œï¼ˆä¸ä»…ä»…æ˜¯å•çº¯çš„k-vï¼‰</li>
<li>å¤„ç†é€Ÿåº¦å¿«ï¼ˆå•æœºè¯»å†™10W+å·¦å³ï¼‰</li>
<li>æ”¯æŒæ•°æ®æŒä¹…åŒ–</li>
<li>å¤šç§è¯­è¨€APIæ”¯æŒ</li>
</ol>
<p>é™„ï¼š<br>æ›¾æœ‰ä¸€åŒäº‹åœ¨è¿½æº¯Redisæºç ä¹‹åï¼Œè¯„ä»·é“â€œè¿™æ˜¯æˆ‘çœ‹è¿‡æœ€èˆ’æœçš„æºç â€ã€‚<br>æºç æ³¨é‡Šè¯¦ç»†ä¸è¯´ï¼Œå„ç§å˜é‡ã€å‡½æ•°åç§°ä¹Ÿæ˜¯ååˆ†æ ‡å‡†ã€‚<br>ç”±æ­¤å¯è§ä¸€æ–‘</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="å¤´åƒ"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/xiaowangzi.jpg" title="å¤´åƒ" alt="å¤´åƒ"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/xiaowangzi.jpg" title="å¤´åƒ" alt="å¤´åƒ"></a><div class="post-copyright__author_name">ivansli</div><div class="post-copyright__author_desc">å­¦æ— æ­¢å¢ƒ</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="è¯¥æ–‡ç« ä¸ºåŸåˆ›æ–‡ç« ï¼Œæ³¨æ„ç‰ˆæƒåè®®" href="https://blog.ivansli.com/2020/10/09/redis-king-cache/">åŸåˆ›</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://blog.ivansli.com/2020/10/09/redis-king-cache/')">ç¼“å­˜ä¹‹ç‹ - Redis</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="èµèµä½œè€…"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>æ‰“èµä½œè€…</div><div class="reward-main"><div class="reward-all"><!--span.reward-title æ„Ÿè°¢ä½ èµäºˆæˆ‘å‰è¿›çš„åŠ›é‡--><ul class="reward-group"><li class="reward-item"><a href="/img/reward/wechat-small.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/reward/wechat-small.png" alt="å¾®ä¿¡"/></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li><li class="reward-item"><a href="/img/reward/alipay-small.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/reward/alipay-small.png" alt="æ”¯ä»˜å®"/></a><div class="post-qr-code-desc">æ”¯ä»˜å®</div></li></ul><!--a.reward-main-btn(href='/about/#about-reward' target='_blank')//.reward-text èµèµè€…åå•
//.reward-dec å› ä¸ºä½ ä»¬çš„æ”¯æŒè®©æˆ‘æ„è¯†åˆ°å†™æ–‡ç« çš„ä»·å€¼ğŸ™--></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="ä½¿ç”¨æ‰‹æœºè®¿é—®è¿™ç¯‡æ–‡ç« "><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://blog.ivansli.com/2020/10/09/redis-king-cache/"></div><div class="reward-dec">ä½¿ç”¨æ‰‹æœºè®¿é—®è¿™ç¯‡æ–‡ç« </div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=ç¼“å­˜ä¹‹ç‹ - Redis&amp;url=https://blog.ivansli.com/2020/10/09/redis-king-cache/&amp;pic=/img/2021/11/2833663222.jpg" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="å¤åˆ¶é“¾æ¥" onclick="rm.copyPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">æœ¬æ–‡ç³»åŸåˆ›ä½œå“ï¼Œç‰ˆæƒæ‰€æœ‰ï¼ˆç¦æ­¢è½¬è½½ï¼‰</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/redis/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>redis<span class="tagsPageCount">6</span></a><a class="post-meta__box__tags" href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>ä¸­é—´ä»¶<span class="tagsPageCount">13</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="/img/2024/07/helm.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="/pluginsSrc/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="/pluginsSrc/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/10/08/about-cn-language/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/2021/11/3928663611.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">å…³äºä¸­æ–‡ç¼–ç¨‹çš„ä¸€äº›æ€è€ƒ</div></div></a></div><div class="next-post pull-right"><a href="/2020/10/10/c-history/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/2021/11/1446861705.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">æˆ‘çœ¼ä¸­çš„Cè¯­è¨€åŠå…¶èµ·æº</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>å–œæ¬¢è¿™ç¯‡æ–‡ç« çš„äººä¹Ÿçœ‹äº†</span></div><div class="relatedPosts-list"><div><a href="/2023/04/27/230427-redis-config/" title="å…³äºRedisé…ç½®ä¿¡æ¯åˆå§‹åŒ–"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/2023/04/redis-config-001.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-04-27</div><div class="title">å…³äºRedisé…ç½®ä¿¡æ¯åˆå§‹åŒ–</div></div></a></div><div><a href="/2023/06/02/230602-redis-cluster-hashtag/" title="Redis Clusteré›†ç¾¤hash tagåŸç†åˆ†æ"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/2023/06/230602-01.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-06-02</div><div class="title">Redis Clusteré›†ç¾¤hash tagåŸç†åˆ†æ</div></div></a></div><div><a href="/2023/05/30/230530-redis-event-driven/" title="Redisäº‹ä»¶é©±åŠ¨(aeEventLoop)åŸç†åˆ†æ"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/2023/05/2023530-01.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-05-30</div><div class="title">Redisäº‹ä»¶é©±åŠ¨(aeEventLoop)åŸç†åˆ†æ</div></div></a></div><div><a href="/2023/04/26/230426-redis-server/" title="redisServerã€redisDBä¸æ•°æ®å­—å…¸dict"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/2023/04/redis-server-layout.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-04-26</div><div class="title">redisServerã€redisDBä¸æ•°æ®å­—å…¸dict</div></div></a></div><div><a href="/2021/05/18/distributed-lock/" title="ä½¿ç”¨åˆ†å¸ƒå¼é”æ—¶è¦è€ƒè™‘çš„äº‹æƒ…"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/space-man-small.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2021-05-18</div><div class="title">ä½¿ç”¨åˆ†å¸ƒå¼é”æ—¶è¦è€ƒè™‘çš„äº‹æƒ…</div></div></a></div><div><a href="/2021/05/24/etcd-lock/" title="etcdä¸åˆ†å¸ƒå¼é”çš„å®ç°åŠåŸç†"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/space-man-small.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2021-05-24</div><div class="title">etcdä¸åˆ†å¸ƒå¼é”çš„å®ç°åŠåŸç†</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/xiaowangzi.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/goutou.png" ait="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">è¿™é‡Œæœ‰<b style="color:#fff">çŸ¥è¯†æ€»ç»“</b>å’Œ<b style="color:#fff">æŠ€æœ¯åˆ†äº«</b>ã€‚ä¹¦å±±æœ‰è·¯å‹¤ä¸ºå¾„ï¼Œå­¦æµ·æ— æ¶¯è‹¦ä½œèˆŸã€‚<b style="color:#fff">æ­¤ç”Ÿä¹Ÿæœ‰æ¶¯</b>ï¼Œ<b style="color:#fff">æ­¤ç”Ÿå­¦æ— æ¶¯</b>ã€‚</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">ivansli</h1><div class="author-info__desc">å­¦æ— æ­¢å¢ƒ</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/coderstart" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>æ–‡ç« ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Redis%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.</span> <span class="toc-text">1. Redisæ˜¯ä»€ä¹ˆ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Redis%E7%94%B1%E6%9D%A5"><span class="toc-number">2.</span> <span class="toc-text">2. Redisç”±æ¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Redis%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%AB%EF%BC%9F"><span class="toc-number">3.</span> <span class="toc-text">3. Redisä¸ºä»€ä¹ˆå¿«ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-RESP%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.</span> <span class="toc-text">4. RESPåè®®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E4%B8%B0%E5%AF%8C%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.</span> <span class="toc-text">5. ä¸°å¯Œçš„æ•°æ®ç±»å‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E6%95%B0%E6%8D%AE%E8%BF%87%E6%9C%9F%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5"><span class="toc-number">6.</span> <span class="toc-text">6. æ•°æ®è¿‡æœŸæ·˜æ±°ç­–ç•¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">7.</span> <span class="toc-text">7. æŒä¹…åŒ–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">8.</span> <span class="toc-text">å°ç»“</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>æœ€è¿‘å‘å¸ƒ</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/07/07/240707-helm/" title="helmçš„å®‰è£…/ä½¿ç”¨åŠå…¶è¿è¡ŒåŸç†"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/2024/07/helm.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="helmçš„å®‰è£…/ä½¿ç”¨åŠå…¶è¿è¡ŒåŸç†"/></a><div class="content"><a class="title" href="/2024/07/07/240707-helm/" title="helmçš„å®‰è£…/ä½¿ç”¨åŠå…¶è¿è¡ŒåŸç†">helmçš„å®‰è£…/ä½¿ç”¨åŠå…¶è¿è¡ŒåŸç†</a><time datetime="2024-07-07T01:00:00.000Z" title="å‘è¡¨äº 2024-07-07 09:00:00">2024-07-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/11/11/theroadtoserfdom/" title="è¯»ï¼šå“ˆè€¶å…‹ã€Šåˆ°å¥´å½¹ä¹‹è·¯ã€‹æœ‰æ„Ÿ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/2023/11/hayeke.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="è¯»ï¼šå“ˆè€¶å…‹ã€Šåˆ°å¥´å½¹ä¹‹è·¯ã€‹æœ‰æ„Ÿ"/></a><div class="content"><a class="title" href="/2023/11/11/theroadtoserfdom/" title="è¯»ï¼šå“ˆè€¶å…‹ã€Šåˆ°å¥´å½¹ä¹‹è·¯ã€‹æœ‰æ„Ÿ">è¯»ï¼šå“ˆè€¶å…‹ã€Šåˆ°å¥´å½¹ä¹‹è·¯ã€‹æœ‰æ„Ÿ</a><time datetime="2023-11-11T01:44:00.000Z" title="å‘è¡¨äº 2023-11-11 09:44:00">2023-11-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/07/231007-game-theory3/" title="äºŒäººé›¶å’Œåšå¼ˆä¸æœ€å¤§æœ€å°å®šç†"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/2023/09/gametheory-01.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="äºŒäººé›¶å’Œåšå¼ˆä¸æœ€å¤§æœ€å°å®šç†"/></a><div class="content"><a class="title" href="/2023/10/07/231007-game-theory3/" title="äºŒäººé›¶å’Œåšå¼ˆä¸æœ€å¤§æœ€å°å®šç†">äºŒäººé›¶å’Œåšå¼ˆä¸æœ€å¤§æœ€å°å®šç†</a><time datetime="2023-10-07T08:45:00.000Z" title="å‘è¡¨äº 2023-10-07 16:45:00">2023-10-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/07/231007-game-theory2/" title="åšå¼ˆè®ºå¯¹ä¸€èˆ¬é—®é¢˜çš„å»ºæ¨¡åˆ†æ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/2023/09/gametheory-01.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="åšå¼ˆè®ºå¯¹ä¸€èˆ¬é—®é¢˜çš„å»ºæ¨¡åˆ†æ"/></a><div class="content"><a class="title" href="/2023/10/07/231007-game-theory2/" title="åšå¼ˆè®ºå¯¹ä¸€èˆ¬é—®é¢˜çš„å»ºæ¨¡åˆ†æ">åšå¼ˆè®ºå¯¹ä¸€èˆ¬é—®é¢˜çš„å»ºæ¨¡åˆ†æ</a><time datetime="2023-10-07T03:40:00.000Z" title="å‘è¡¨äº 2023-10-07 11:40:00">2023-10-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/09/18/230918-game-theory/" title="è®¤è¯†åšå¼ˆè®º"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/2023/09/gametheory-01.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="è®¤è¯†åšå¼ˆè®º"/></a><div class="content"><a class="title" href="/2023/09/18/230918-game-theory/" title="è®¤è¯†åšå¼ˆè®º">è®¤è¯†åšå¼ˆè®º</a><time datetime="2023-09-18T10:00:00.000Z" title="å‘è¡¨äº 2023-09-18 18:00:00">2023-09-18</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><!-- - let centerImg = theme.footer.socialBar.centerImg ? theme.footer.socialBar.centerImg : theme.avatar.img--><div id="footer_deal"><!-- å·¦ä¾§å›¾æ ‡--><a class="deal_link" href="mailto:gopher001@outlook.com" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><!--ä¸ªäººå¤´åƒå›¾æ ‡--><!--img.footer_mini_logo(title="è¿”å›é¡¶éƒ¨", alt="è¿”å›é¡¶éƒ¨" onclick="anzhiyu.scrollToDest(0, 500)", src=centerImg, size="50px")--><!-- å³ä¾§å›¾æ ‡--><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/coderstart" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" href="/copyright" title="CC"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i></a></div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">å¯¼èˆª</div><div class="footer-links"><a class="footer-item" title="æ–‡ç« åˆ—è¡¨" href="/archives/">æ–‡ç« åˆ—è¡¨</a><a class="footer-item" title="æˆ‘çš„ä¹¦å•" href="/booklist/">æˆ‘çš„ä¹¦å•</a><a class="footer-item" title="æå®¢è¯´è¯´" href="/essay/">æå®¢è¯´è¯´</a><a class="footer-item" title="å…³äºæœ¬ç«™" href="/about/">å…³äºæœ¬ç«™</a></div></div><div class="footer-group"><div class="footer-title">åˆ†ç±»</div><div class="footer-links"><a class="footer-item" title="ç¼–ç¨‹åŸç†" href="/categories/%E7%BC%96%E7%A8%8B%E5%8E%9F%E7%90%86/">ç¼–ç¨‹åŸç†</a><a class="footer-item" title="ç³»ç»Ÿæ¶æ„" href="/categories/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/">ç³»ç»Ÿæ¶æ„</a><a class="footer-item" title="ä¸­é—´ä»¶" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/">ä¸­é—´ä»¶</a><a class="footer-item" title="ç¼–ç¨‹åŸç†" href="/categories/%E7%BC%96%E7%A8%8B%E5%8E%9F%E7%90%86/">ç¼–ç¨‹åŸç†</a></div></div><div class="footer-group"><div class="footer-title">åè®®</div><div class="footer-links"><a class="footer-item" title="éšç§åè®®" href="/privacy/">éšç§åè®®</a><a class="footer-item" title="Cookies" href="/cookies/">Cookies</a><a class="footer-item" title="ç‰ˆæƒåè®®" href="/copyright/">ç‰ˆæƒåè®®</a></div></div><div class="footer-group"><div class="footer-title">å‹é“¾</div><div class="footer-links"><a class="footer-item" title="ç¼–ç¨‹å¯¼èˆª" target="_blank" rel="noopener" href="https://tool.ivansli.com/">ç¼–ç¨‹å¯¼èˆª</a></div></div></div><p id="ghbdages"><a class="github-badge" target="_blank" style="margin-inline:5px" data-title="åšå®¢æ¡†æ¶ä¸ºHexo" title="åšå®¢æ¡†æ¶ä¸ºHexo"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/badge/Frame-Hexo.svg" alt="åšå®¢æ¡†æ¶ä¸ºHexo"/></a><a class="github-badge" target="_blank" style="margin-inline:5px" data-title="æœ¬ç«™ä½¿ç”¨AnZhiYuä¸»é¢˜" title="æœ¬ç«™ä½¿ç”¨AnZhiYuä¸»é¢˜"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/badge/Theme-AnZhiYu-2E67D3.svg" alt="æœ¬ç«™ä½¿ç”¨AnZhiYuä¸»é¢˜"/></a><a class="github-badge" target="_blank" style="margin-inline:5px" data-title="æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯" title="æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/badge/Copyright-BY-NC-SA.svg" alt="æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2019 - 2024 Â· <a class="footer-bar-link" href="/" title="ivansli" target="_blank">ivansli</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="http://beian.miit.gov.cn" title="æ²ªICPå¤‡2021031949å·">æ²ªICPå¤‡2021031949å·</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://tool.ivansli.com" title="ç¼–ç¨‹å¯¼èˆª">ç¼–ç¨‹å¯¼èˆª</a><a class="footer-bar-link cc" href="/" title="ccåè®®"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-by-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nc-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nd-line"></i></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">æ–‡ç« </div><div class="length-num">80</div></a><a href="/tags/" title="tag"><div class="headline">æ ‡ç­¾</div><div class="length-num">37</div></a><a href="/categories/" title="category"><div class="headline">åˆ†ç±»</div><div class="length-num">20</div></a></div><span class="sidebar-menu-item-title">åŠŸèƒ½</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="æ˜¾ç¤ºæ¨¡å¼"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>æ˜¾ç¤ºæ¨¡å¼</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="anzhiyufont anzhiyu-icon-house-chimney faa-tada"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/booklist/"><i class="anzhiyufont anzhiyu-icon-book faa-tada"></i><span> ä¹¦å•</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada"></i><span> å…³äº</span></a></div></div><span class="sidebar-menu-item-title">æ ‡ç­¾</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Apple/" style="font-size: 0.88rem;">Apple<sup>2</sup></a><a href="/tags/CI-CD/" style="font-size: 0.88rem;">CI/CD<sup>1</sup></a><a href="/tags/C%E8%AF%AD%E8%A8%80/" style="font-size: 0.88rem;">Cè¯­è¨€<sup>1</sup></a><a href="/tags/Docker/" style="font-size: 0.88rem;">Docker<sup>2</sup></a><a href="/tags/IoT/" style="font-size: 0.88rem;">IoT<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>2</sup></a><a href="/tags/MySQL/" style="font-size: 0.88rem;">MySQL<sup>5</sup></a><a href="/tags/PHP/" style="font-size: 0.88rem;">PHP<sup>1</sup></a><a href="/tags/Python/" style="font-size: 0.88rem;">Python<sup>1</sup></a><a href="/tags/Unix/" style="font-size: 0.88rem;">Unix<sup>2</sup></a><a href="/tags/ZooKeeper/" style="font-size: 0.88rem;">ZooKeeper<sup>1</sup></a><a href="/tags/crontab/" style="font-size: 0.88rem;">crontab<sup>1</sup></a><a href="/tags/git/" style="font-size: 0.88rem;">git<sup>4</sup></a><a href="/tags/gitlab/" style="font-size: 0.88rem;">gitlab<sup>1</sup></a><a href="/tags/golang/" style="font-size: 0.88rem;">golang<sup>31</sup></a><a href="/tags/grpc-go/" style="font-size: 0.88rem;">grpc-go<sup>3</sup></a><a href="/tags/k8s/" style="font-size: 0.88rem;">k8s<sup>1</sup></a><a href="/tags/redis/" style="font-size: 0.88rem;">redis<sup>6</sup></a><a href="/tags/%E4%B8%AD%E6%96%87%E7%BC%96%E7%A8%8B/" style="font-size: 0.88rem;">ä¸­æ–‡ç¼–ç¨‹<sup>1</sup></a><a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 0.88rem;">ä¸­é—´ä»¶<sup>13</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8FID/" style="font-size: 0.88rem;">åˆ†å¸ƒå¼ID<sup>1</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" style="font-size: 0.88rem;">åˆ†å¸ƒå¼é”<sup>1</sup></a><a href="/tags/%E5%8D%9A%E5%BC%88%E8%AE%BA/" style="font-size: 0.88rem;">åšå¼ˆè®º<sup>3</sup></a><a href="/tags/%E5%8F%B7%E6%AE%B5%E5%8F%91%E5%8F%B7%E5%99%A8/" style="font-size: 0.88rem;">å·æ®µå‘å·å™¨<sup>1</sup></a><a href="/tags/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/" style="font-size: 0.88rem;">å¸¸è§é—®é¢˜<sup>6</sup></a><a href="/tags/%E6%8C%87%E6%95%B0%E9%80%80%E9%81%BF/" style="font-size: 0.88rem;">æŒ‡æ•°é€€é¿<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 0.88rem;">æ•°æ®åº“<sup>1</sup></a><a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size: 0.88rem;">æ¶ˆæ¯é˜Ÿåˆ—<sup>1</sup></a><a href="/tags/%E7%AE%97%E6%B3%95%E6%8A%80%E5%B7%A7/" style="font-size: 0.88rem;">ç®—æ³•æŠ€å·§<sup>6</sup></a><a href="/tags/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/" style="font-size: 0.88rem;">ç³»ç»Ÿæ¶æ„<sup>5</sup></a><a href="/tags/%E7%BB%8F%E6%B5%8E%E5%AD%A6/" style="font-size: 0.88rem;">ç»æµå­¦<sup>4</sup></a><a href="/tags/%E7%BC%96%E7%A8%8B%E5%8E%86%E5%8F%B2/" style="font-size: 0.88rem;">ç¼–ç¨‹å†å²<sup>8</sup></a><a href="/tags/%E7%BC%96%E7%A8%8B%E5%8E%9F%E7%90%86/" style="font-size: 0.88rem;">ç¼–ç¨‹åŸç†<sup>31</sup></a><a href="/tags/%E7%BC%96%E7%A8%8B%E5%B7%A5%E5%85%B7/" style="font-size: 0.88rem;">ç¼–ç¨‹å·¥å…·<sup>1</sup></a><a href="/tags/%E8%81%8C%E5%9C%BA%E5%BF%83%E5%A3%B0/" style="font-size: 0.88rem;">èŒåœºå¿ƒå£°<sup>1</sup></a><a href="/tags/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/" style="font-size: 0.88rem;">è½¯ä»¶å·¥å…·<sup>2</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95%E7%BB%8F%E9%AA%8C/" style="font-size: 0.88rem;">é¢è¯•ç»éªŒ<sup>4</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç¹</button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>å¤åˆ¶é€‰ä¸­æ–‡æœ¬</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>ç²˜è´´æ–‡æœ¬</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>å¼•ç”¨åˆ°è¯„è®º</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>æ–°çª—å£æ‰“å¼€</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>å¤åˆ¶é“¾æ¥åœ°å€</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>å¤åˆ¶æ­¤å›¾ç‰‡</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>ä¸‹è½½æ­¤å›¾ç‰‡</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>æ–°çª—å£æ‰“å¼€å›¾ç‰‡</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>ç«™å†…æœç´¢</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>ç™¾åº¦æœç´¢</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>æ’­æ”¾éŸ³ä¹</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>åˆ‡æ¢åˆ°ä¸Šä¸€é¦–</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>åˆ‡æ¢åˆ°ä¸‹ä¸€é¦–</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>æŸ¥çœ‹æ‰€æœ‰æ­Œæ›²</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>å¤åˆ¶æ­Œå</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>éšä¾¿é€›é€›</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>åšå®¢åˆ†ç±»</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>æ–‡ç« æ ‡ç­¾</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>å¤åˆ¶åœ°å€</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">å…³é—­çƒ­è¯„</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">æ·±è‰²æ¨¡å¼</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>è½‰ç‚ºç¹é«”</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="/pluginsSrc/@fancyapps/ui/dist/fancybox/fancybox.umd.js"></script><script src="/pluginsSrc/instant.page/instantpage.js" type="module"></script><script src="/pluginsSrc/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/pluginsSrc/node-snackbar/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script async data-pjax src="/pluginsSrc/anzhiyu-theme-static/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="/pluginsSrc/anzhiyu-theme-static/icon/ali_iconfont_css.css"><script defer="defer" id="fluttering_ribbon" mobile="true" src="/pluginsSrc/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><link rel="stylesheet" href="/pluginsSrc/anzhiyu-theme-static/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="/pluginsSrc/anzhiyu-blog-static/js/APlayer.min.js"></script><script src="/pluginsSrc/hexo-anzhiyu-music/assets/js/Meting2.min.js"></script><script src="/pluginsSrc/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="/pluginsSrc/anzhiyu-theme-static/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">é€šçŸ¥</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">ä½ å¥½å‘€</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>